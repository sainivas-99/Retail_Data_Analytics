---
title: "Retail Data Analytics"
output: html_document
date: "2023-10-25"
---
```{r}
features_data <- read.csv("/Users/sainivasrangaraju/Desktop/Project/Code/Retail Data Analytics/Datasets/Features data set.csv",na.strings = "NA")
sales_data <- read.csv("/Users/sainivasrangaraju/Desktop/Project/Code/Retail Data Analytics/Datasets/sales data-set.csv")
stores_data  <- read.csv("/Users/sainivasrangaraju/Desktop/Project/Code/Retail Data Analytics/Datasets/stores data-set.csv")
```
```{r}
str(stores_data)
unique(stores_data$Type)
dim(stores_data)
```
```{r}
summary(stores_data)
```
#Data Preprocessing:
## Problems with Store data:
  1. Type: Factor...?
```{r}
str(sales_data)
dim(sales_data)
```
```{r}
summary(sales_data)
```
##Problems with Sales data:
  1. Date : chr-> date : Done
  2. Weekly sales: why is the Weekly_Sales min a negative value?
  
##Solving for 1 in sales
```{r}
sales_data$Date <- as.Date(sales_data$Date, format = "%d/%m/%Y")
str(sales_data)
```
##Looking into 2 in sales:
```{r}
#View(sales_data)
```
The Weekly_sales have many negative values, so we can assume that this is due
to maybe returns or refunds to customers, theft or shrinkage or losses or maybe
due to promotional discounts. So we keep them as it is.
```{r}
head(features_data)
```

```{r}
str(features_data)
dim(features_data)
```
```{r}
summary(features_data)
```

## Problems with Features Data:
  1. Date column: chr -> date
  2. Markdown columns: have NA values, how to deal with them?
    a. Probably put it as zero, as the promotion is not available all time
       in all stores.
  3. CPI has NA values.
  4. Unemployment Rate has NA values, how to deal with them?

##Solving 1 for features: 
```{r}
features_data$Date <- as.Date(features_data$Date, format = "%d/%m/%Y")
summary(features_data$Date)
```
##Looking into 2 for features:
```{r}
MD1.na_count <- sum(is.na(features_data$MarkDown1))
MD1.na_count
```
```{r}
MD2.na_count <- sum(is.na(features_data$MarkDown2))
MD2.na_count
```
```{r}
MD3.na_count <- sum(is.na(features_data$MarkDown3))
MD3.na_count
```
```{r}
MD4.na_count <- sum(is.na(features_data$MarkDown4))
MD4.na_count
```
```{r}
MD5.na_count <- sum(is.na(features_data$MarkDown5))
MD5.na_count
```
```{r}
features_data$MarkDown1 <- ifelse(is.na(features_data$MarkDown1),0,
                                  features_data$MarkDown1)
features_data$MarkDown2 <- ifelse(is.na(features_data$MarkDown2),0,
                                  features_data$MarkDown2)
features_data$MarkDown3 <- ifelse(is.na(features_data$MarkDown3),0,
                                  features_data$MarkDown3)
features_data$MarkDown4 <- ifelse(is.na(features_data$MarkDown4),0,
                                  features_data$MarkDown4)
features_data$MarkDown5 <- ifelse(is.na(features_data$MarkDown5),0,
                                  features_data$MarkDown5)
```
```{r}
MD1.na_count <- sum(is.na(features_data$MarkDown1))
MD1.na_count
```
```{r}
MD2.na_count <- sum(is.na(features_data$MarkDown2))
MD2.na_count
```
```{r}
MD3.na_count <- sum(is.na(features_data$MarkDown3))
MD3.na_count
```
```{r}
MD4.na_count <- sum(is.na(features_data$MarkDown4))
MD4.na_count
```
```{r}
MD5.na_count <- sum(is.na(features_data$MarkDown5))
MD5.na_count
```

## Dealing with 3 in features
```{r}
CPI.na.count <- sum(is.na(features_data$CPI))
CPI.na.count
```
```{r}
Unemp.na.count <- sum(is.na(features_data$Unemployment))
Unemp.na.count
```
```{r}
library(dplyr)
cpi_features_data <- filter(features_data, !is.na(CPI)& !is.na(Unemployment))
cpi_features_data
```
When CPI is NA, then Unemployment is also NA. Gotta check this.
```{r}
cormatrix <- cor(cpi_features_data[,-2])
corrplot::corrplot(cormatrix, method = "number")
```
We noticed that there is a negative correlation of -0.3 between CPI and 
Unemployment, also we got to know that there is significant correlation 
between Markdown1 and Markdown4.

```{r}
str(stores_data)
```
```{r}
str(sales_data)
```

```{r}
head(stores_data)
```
```{r}
head(features_data)
```
```{r}
names(features_data)
names(sales_data)
```
```{r}
library(lubridate)
sales_data$Week <- week(sales_data$Date)
sales_data$Month <- month(sales_data$Date)
sales_data$Year <- year(sales_data$Date)
```
```{r}
head(sales_data)
```
```{r}
features_data$Week <- week(features_data$Date)
features_data$Month <- month(features_data$Date)
features_data$Year <- year(features_data$Date)
```
```{r}
head(features_data)
```
```{r}
summary(sales_data)
```
```{r}
filtered_sales <- sales_data %>% filter(Year %in% c(2010, 2011, 2012))
head(filtered_sales)
```


```{r}
weekly_sales_sum <- filtered_sales %>% group_by(Year, Week) %>%
  summarise(Total_Weekly_Sales = sum(Weekly_Sales))
head(weekly_sales_sum)
```


```{r}
library(ggplot2)
ggplot(weekly_sales_sum, aes(x = Week, y = Total_Weekly_Sales, color = factor(Year))) +
  geom_line() +
  labs(
    title = "Total Weekly Sales for 2010, 2011, and 2012"
  ) +
  scale_x_continuous(breaks = seq(0, 52, by = 4)) +
  scale_y_continuous(labels = scales::number_format(scale = 1e-3, suffix = "K"))+
  scale_color_discrete(name = "Year")
```
Weeks 6, 14, 26, 47, 51 have local maxima in the total sum over the years 2010, 2011
and 2012. The weeks 6, 47 and 51 are holiday weeks and hence have higher sales,
indicating a positive impact of holidays on sales.
```{r}
mean_monthly_sales <- filtered_sales %>% group_by(Year, Month) %>%
  summarise(Mean_Monthly_Sales = mean(Weekly_Sales))
head(mean_monthly_sales)
```
```{r}
ggplot(mean_monthly_sales, mapping = aes(x = Month, y = Mean_Monthly_Sales,
                                         color = factor(Year)))+
  geom_line()+
  labs(title = "Mean of Sales over weeks")+
  scale_x_continuous(breaks = seq(0, 12, by = 1))+
  scale_color_discrete(name = "Year")
```
The sales peaked at months 2, 6, 8 and are increasing in months 10-12, as these
have holidays. Moreover, the mean sales are comparably greater during months:
5 to 7 excluding holiday effect during the months 10-12. This is likely
indicating that the sales are higher during the summer.

```{r}
features_sales_merged <- merge(sales_data, features_data,
                               by = c("Store","Date","IsHoliday","Week",
                                      "Month","Year"))
merged_data <- merge(stores_data,features_sales_merged,
               by = "Store")
head(merged_data)
```
